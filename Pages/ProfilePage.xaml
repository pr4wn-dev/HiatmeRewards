<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:HiatMeApp.Controls"
             xmlns:converters="clr-namespace:HiatMeApp.Converters"
             x:Class="HiatMeApp.ProfilePage"
             Title="{Binding Title}"
             BackgroundColor="#333333"
             Shell.NavBarIsVisible="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid RowDefinitions="Auto,*,Auto">
        <local:TopBar Grid.Row="0" />
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="15">
                <Label Text="Your Profile" 
                       FontSize="26" 
                       HorizontalOptions="Center" 
                       FontAttributes="Bold"
                       TextColor="White"
                       Margin="0,10,0,5" />
                <BoxView HeightRequest="2"
                         BackgroundColor="#007BFF"
                         HorizontalOptions="FillAndExpand"
                         Margin="0,0,0,10" />
                
                <!-- Profile Picture Card -->
                <Frame BackgroundColor="#3A3A3A"
                       BorderColor="#555555"
                       CornerRadius="12"
                       Padding="20"
                       Margin="0,0,0,5">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Frame BackgroundColor="#444444"
                               CornerRadius="60"
                               WidthRequest="120"
                               HeightRequest="120"
                               Padding="3"
                               HasShadow="False"
                               HorizontalOptions="Center">
                            <Image x:Name="ProfileImage"
                                   HeightRequest="114" 
                                   WidthRequest="114"
                                   Aspect="AspectFill"
                                   HorizontalOptions="Center" />
                        </Frame>
                        <Button Text="ðŸ“· Change Photo" 
                                FontSize="14"
                                Command="{Binding PickImageCommand}"
                                IsVisible="{Binding IsEditing}"
                                BackgroundColor="#007BFF"
                                TextColor="White"
                                CornerRadius="8"
                                Padding="15,10"
                                HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Frame>
                
                <!-- User Information Card -->
                <Frame BackgroundColor="#3A3A3A"
                       BorderColor="#555555"
                       CornerRadius="12"
                       Padding="20">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Personal Information"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#87CEEB" />
                        
                        <!-- Full Name -->
                        <VerticalStackLayout Spacing="6">
                            <!-- View Mode -->
                            <Grid ColumnDefinitions="Auto,*"
                                  IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}">
                                <Label Grid.Column="0"
                                       Text="Full Name"
                                       FontSize="13"
                                       TextColor="#888888"
                                       WidthRequest="100" />
                                <Label Grid.Column="1"
                                       Text="{Binding Name}" 
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                            </Grid>
                            <!-- Edit Mode -->
                            <local:FloatingLabelEntry LabelText="Full Name"
                                                       Text="{Binding Name}"
                                                       IsVisible="{Binding IsEditing}" />
                        </VerticalStackLayout>
                        
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="#444444"
                                 IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        
                        <!-- Email -->
                        <VerticalStackLayout Spacing="6">
                            <!-- View Mode -->
                            <Grid ColumnDefinitions="Auto,*"
                                  IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}">
                                <Label Grid.Column="0"
                                       Text="Email"
                                       FontSize="13"
                                       TextColor="#888888"
                                       WidthRequest="100" />
                                <Label Grid.Column="1"
                                       Text="{Binding Email}" 
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                            </Grid>
                            <!-- Edit Mode -->
                            <local:FloatingLabelEntry LabelText="Email"
                                                       Text="{Binding Email}"
                                                       Keyboard="Email"
                                                       IsVisible="{Binding IsEditing}" />
                        </VerticalStackLayout>
                        
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="#444444"
                                 IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        
                        <!-- Phone Number -->
                        <VerticalStackLayout Spacing="6">
                            <!-- View Mode -->
                            <Grid ColumnDefinitions="Auto,*"
                                  IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}">
                                <Label Grid.Column="0"
                                       Text="Phone"
                                       FontSize="13"
                                       TextColor="#888888"
                                       WidthRequest="100" />
                                <Label Grid.Column="1"
                                       Text="{Binding Phone, TargetNullValue='Not provided'}" 
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                            </Grid>
                            <!-- Edit Mode -->
                            <local:FloatingLabelEntry LabelText="Phone Number"
                                                       Text="{Binding Phone}"
                                                       Keyboard="Telephone"
                                                       IsVisible="{Binding IsEditing}" />
                        </VerticalStackLayout>
                        
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="#444444"
                                 IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        
                        <!-- Role (Non-editable) -->
                        <Grid ColumnDefinitions="Auto,*,Auto"
                              IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}">
                            <Label Grid.Column="0"
                                   Text="Role"
                                   FontSize="13"
                                   TextColor="#888888"
                                   WidthRequest="100" />
                            <Label Grid.Column="1"
                                   Text="{Binding Role}" 
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="White" />
                            <Frame Grid.Column="2"
                                   BackgroundColor="#007BFF"
                                   CornerRadius="12"
                                   Padding="12,5"
                                   HasShadow="False">
                                <Label Text="{Binding Role}"
                                       FontSize="11"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                            </Frame>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Action Buttons -->
                <VerticalStackLayout Spacing="12" Margin="0,10,0,0">
                    <!-- Edit Button (View Mode) -->
                    <Button Text="âœï¸ Edit Profile" 
                            FontSize="18"
                            Command="{Binding StartEditingCommand}"
                            IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}"
                            BackgroundColor="#007BFF"
                            TextColor="White"
                            CornerRadius="8"
                            HeightRequest="50" />
                    
                    <!-- Save/Cancel Buttons (Edit Mode) -->
                    <Grid ColumnDefinitions="*,*" 
                          ColumnSpacing="12"
                          IsVisible="{Binding IsEditing}">
                        <Button Text="Cancel" 
                                FontSize="16"
                                Command="{Binding CancelEditingCommand}"
                                Grid.Column="0"
                                BackgroundColor="#6c757d"
                                TextColor="White"
                                CornerRadius="8"
                                HeightRequest="50" />
                        
                        <Button Text="ðŸ’¾ Save Changes" 
                                FontSize="16"
                                Command="{Binding SaveProfileCommand}"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                                Grid.Column="1"
                                BackgroundColor="#28a745"
                                TextColor="White"
                                CornerRadius="8"
                                HeightRequest="50" />
                    </Grid>
                    
                    <!-- Loading Indicator -->
                    <ActivityIndicator IsRunning="{Binding IsBusy}"
                                       IsVisible="{Binding IsBusy}"
                                       Color="#007BFF"
                                       HorizontalOptions="Center" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
        <local:NavigationBar Grid.Row="2" />
    </Grid>
</ContentPage>
