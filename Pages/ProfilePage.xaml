<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:HiatMeApp.Controls"
             xmlns:converters="clr-namespace:HiatMeApp.Converters"
             x:Class="HiatMeApp.ProfilePage"
             Title="{Binding Title}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid RowDefinitions="Auto,*,Auto">
        <local:TopBar Grid.Row="0" />
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="18">
                <Label Text="Profile" 
                       FontSize="26" 
                       HorizontalOptions="Center" 
                       FontAttributes="Bold"
                       TextColor="White"
                       Margin="0,10,0,20" />
                
                <!-- Profile Picture -->
                <Frame HorizontalOptions="Center" 
                       Padding="15" 
                       BorderColor="#666" 
                       BackgroundColor="#444"
                       CornerRadius="8" 
                       Margin="0,0,0,20">
                    <VerticalStackLayout Spacing="12">
                        <Image x:Name="ProfileImage"
                               HeightRequest="120" 
                               WidthRequest="120"
                               Aspect="AspectFill"
                               HorizontalOptions="Center" />
                        <Button Text="Change Picture" 
                                FontSize="16"
                                Command="{Binding PickImageCommand}"
                                IsVisible="{Binding IsEditing}"
                                BackgroundColor="#007bff"
                                TextColor="White"
                                HorizontalOptions="Center"
                                Padding="15,8" />
                    </VerticalStackLayout>
                </Frame>
                
                <!-- User Information -->
                <Frame Padding="18" 
                       BorderColor="#666" 
                       BackgroundColor="#444"
                       CornerRadius="8">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Name" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="White" />
                        <Label Text="{Binding Name}" 
                               FontSize="18"
                               TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        <Entry Text="{Binding Name}" 
                               FontSize="18"
                               BackgroundColor="#555"
                               TextColor="White"
                               IsVisible="{Binding IsEditing}"
                               Placeholder="Enter your name"
                               PlaceholderColor="#999" />
                        
                        <Label Text="Email" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="White"
                               Margin="0,10,0,0" />
                        <Label Text="{Binding Email}" 
                               FontSize="18"
                               TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        <Entry Text="{Binding Email}" 
                               FontSize="18"
                               BackgroundColor="#555"
                               TextColor="White"
                               Keyboard="Email"
                               IsVisible="{Binding IsEditing}"
                               Placeholder="Enter your email"
                               PlaceholderColor="#999" />
                        
                        <Label Text="Phone" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="White"
                               Margin="0,10,0,0" />
                        <Label Text="{Binding Phone, TargetNullValue='Not provided'}" 
                               FontSize="18"
                               TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}" />
                        <Entry Text="{Binding Phone}" 
                               FontSize="18"
                               BackgroundColor="#555"
                               TextColor="White"
                               Keyboard="Telephone"
                               IsVisible="{Binding IsEditing}"
                               Placeholder="Enter your phone number"
                               PlaceholderColor="#999" />
                        
                        <Label Text="Role" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="White"
                               Margin="0,10,0,0" />
                        <Label Text="{Binding Role}" 
                               FontSize="18"
                               TextColor="White" />
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Action Buttons -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="12" 
                      Margin="0,25,0,0">
                    <Button Text="Edit" 
                            FontSize="18"
                            Command="{Binding StartEditingCommand}"
                            IsVisible="{Binding IsEditing, Converter={StaticResource InverseBooleanConverter}}"
                            Grid.Column="0"
                            Grid.ColumnSpan="2"
                            BackgroundColor="#007bff"
                            TextColor="White" />
                    
                    <Button Text="Cancel" 
                            FontSize="18"
                            Command="{Binding CancelEditingCommand}"
                            IsVisible="{Binding IsEditing}"
                            Grid.Column="0"
                            BackgroundColor="#6c757d"
                            TextColor="White" />
                    
                    <Button Text="Save" 
                            FontSize="18"
                            Command="{Binding SaveProfileCommand}"
                            IsVisible="{Binding IsEditing}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                            Grid.Column="1"
                            BackgroundColor="#28a745"
                            TextColor="White" />
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
        <local:NavigationBar Grid.Row="2" />
    </Grid>
</ContentPage>

