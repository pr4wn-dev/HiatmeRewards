<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:HiatMeApp.Controls"
             x:Class="HiatMeApp.VehiclePage"
             Title="{Binding Title}"
             BackgroundColor="#333333"
             Shell.NavBarIsVisible="False">
    <Grid RowDefinitions="Auto,*,Auto">
        <local:TopBar Grid.Row="0" />
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="15">
                <Label Text="Your Vehicle" 
                       FontSize="26" 
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center" 
                       Margin="0,10,0,10" />
                <BoxView HeightRequest="2"
                         BackgroundColor="#007BFF"
                         HorizontalOptions="FillAndExpand"
                         Margin="0,0,0,20" />
                <Frame IsVisible="{Binding Vehicle, Converter={StaticResource NotNullConverter}}"
                       Padding="15" 
                       BorderColor="#666" 
                       BackgroundColor="#444"
                       CornerRadius="8"
                       Margin="0,0,0,15">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding Vehicle.Make, TargetNullValue=''}" 
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="White" />
                        <Label Text="{Binding Vehicle.Model, TargetNullValue=''}" 
                               FontSize="18"
                               TextColor="White" />
                        <Label Text="{Binding Vehicle.LastSixVin, StringFormat='VIN Ending: {0}', TargetNullValue='VIN Ending: '}" 
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.LicensePlate, StringFormat='License Plate: {0}', TargetNullValue='License Plate: '}" 
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.Year, StringFormat='Year: {0}', TargetNullValue='Year: '}" 
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.Color, StringFormat='Color: {0}', TargetNullValue='Color: '}" 
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.Vin, StringFormat='Full VIN: {0}', TargetNullValue='Full VIN: '}" 
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.MileageRecord.StartMiles, StringFormat='Start Miles: {0:F2}'}"
                               IsVisible="{Binding Vehicle.MileageRecord, Converter={StaticResource NotNullConverter}}"
                               FontSize="16"
                               TextColor="#cccccc" />
                        <Label Text="{Binding Vehicle.MileageRecord.EndingMiles, StringFormat='End Miles: {0:F2}'}"
                               IsVisible="{Binding Vehicle.MileageRecord.EndingMiles, Converter={StaticResource NotNullConverter}}"
                               FontSize="16"
                               TextColor="#cccccc" />
                    </VerticalStackLayout>
                </Frame>
                <Label Text="No vehicle assigned."
                       IsVisible="{Binding NoVehicleMessageVisible}"
                       HorizontalOptions="Center"
                       FontSize="18"
                       TextColor="#ff6b6b" />
                <Button Text="Assign/Change Vehicle"
                        FontSize="18"
                        IsVisible="{Binding IsVehicleButtonVisible}"
                        Command="{Binding AssignVehicleByVinCommand}"
                        BackgroundColor="#007bff"
                        TextColor="White"
                        HorizontalOptions="Center"
                        Margin="0,10,0,10" />
                <Button Text="Submit End Mileage"
                        FontSize="18"
                        IsVisible="{Binding Vehicle.MileageRecord, Converter={StaticResource NotNullConverter}}"
                        IsEnabled="{Binding Vehicle.MileageRecord.EndingMiles, Converter={StaticResource NotNullConverter}, ConverterParameter=Inverse}"
                        Command="{Binding SubmitEndMileageCommand}"
                        BackgroundColor="#28a745"
                        TextColor="White"
                        HorizontalOptions="Center"
                        Margin="0,10,0,0" />
            </VerticalStackLayout>
        </ScrollView>
        <local:NavigationBar Grid.Row="2" BindingContext="{Binding .}" />
    </Grid>
</ContentPage>